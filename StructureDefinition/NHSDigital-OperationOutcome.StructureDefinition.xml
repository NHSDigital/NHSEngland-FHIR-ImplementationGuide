<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="England-OperationOutcome" />
  <url value="https://fhir.nhs.uk/StructureDefinition/England-OperationOutcome" />
  <version value="1.0.0" />
  <name value="EnglandOperationOutcome" />
  <title value="England OperationOutcome" />
  <status value="draft" />
  <date value="2023-06-01" />
  <publisher value="NHS England" />
  <contact>
    <name value="NHS England" />
    <telecom>
      <system value="email" />
      <value value="interoperabilityteam@nhs.net" />
      <use value="work" />
      <rank value="1" />
    </telecom>
  </contact>
  <description value="This profile defines the NHS England constraints and extensions on the UKCore FHIR resource [UKCore OperationOutcome](https://simplifier.net/hl7fhirukcorer4/ukcoreoperationoutcome)" />
  <purpose value="&quot;The purpose of this profile is to provide detailed information about the outcome of an attempted system operation. Operation outcomes are sets of error, warning and information messages provided as a direct system response, or part of one, and provide information about the outcome of the operation.&quot;," />
  <copyright value="&quot;Copyright © 2021+ HL7 UK Licensed under the Apache License, Version 2.0 (the \&quot;License\&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at  http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. HL7® FHIR® standard Copyright © 2011+ HL7 The HL7® FHIR® standard is used under the FHIR license. You may obtain a copy of the FHIR license at  https://www.hl7.org/fhir/license.html.&quot;," />
  <fhirVersion value="4.0.1" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="OperationOutcome" />
  <baseDefinition value="https://fhir.hl7.org.uk/StructureDefinition/UKCore-OperationOutcome" />
  <derivation value="constraint" />
  <differential>
    <element id="OperationOutcome">
      <path value="OperationOutcome" />
      <definition value="The purpose of this profile is to provide detailed information about the outcome of an attempted system operation. Operation outcomes are sets of error, warning and information messages provided as a direct system response, or part of one, and provide information about the outcome of the operation." />
      <comment value="A collection of error, warning, or information messages that result from a system action.&#xD;&#xA;Can result from the failure of a REST call or be part of the response message returned from a request message." />
    </element>
    <element id="OperationOutcome.id">
      <path value="OperationOutcome.id" />
      <short value="uniqueRequestID" />
      <definition value="Internal Apigee messageID" />
    </element>
    <element id="OperationOutcome.meta">
      <path value="OperationOutcome.meta" />
      <definition value="The metadata about the resource. This is content that is maintained by the infrastructure. Changes to the content might not always be associated with version changes to the resource.&#xD;&#xA;&#xD;&#xA;```json&#xD;&#xA; &quot;meta&quot; : {&#xD;&#xA;        &quot;lastUpdated&quot; : &quot;2021-04-21T16:58:00+00:00&quot;&#xD;&#xA;    }&#xD;&#xA;```" />
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.extension">
      <path value="OperationOutcome.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="0" />
    </element>
    <element id="OperationOutcome.extension:supportingInfo">
      <path value="OperationOutcome.extension" />
      <sliceName value="supportingInfo" />
      <definition value="Information relevant to this OperationOutcome. For EPS release rejections this may be the pharmacy which is currently owns the prescription task/order." />
      <min value="0" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-SpineSupportingInfo" />
      </type>
    </element>
    <element id="OperationOutcome.extension:supportingInfoPrescription">
      <path value="OperationOutcome.extension" />
      <sliceName value="supportingInfoPrescription" />
      <short value="Other information that may be relevant to this event" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-SupportingInfoPrescription" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="OperationOutcome.issue">
      <path value="OperationOutcome.issue" />
      <constraint>
        <key value="nhsd-errrorcode" />
        <severity value="error" />
        <human value="An NHS England error or warning code is required" />
        <expression value="(severity = 'information') or ((severity != 'information') and details.empty().not())" />
      </constraint>
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.issue.severity">
      <path value="OperationOutcome.issue.severity" />
      <definition value="Indicates whether the issue indicates a variation from successful processing.&#xD;&#xA;&#xD;&#xA;```json&#xD;&#xA; &quot;severity&quot;: &quot;error&quot;,&#xD;&#xA;```" />
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.issue.code">
      <path value="OperationOutcome.issue.code" />
      <definition value="Describes the type of the issue. The system that creates an OperationOutcome SHALL choose the most applicable code from the IssueType value set, and may additional provide its own code for the error in the details element.&#xD;&#xA;&#xD;&#xA;```json&#xD;&#xA; &quot;code&quot;: &quot;processing&quot;,&#xD;&#xA;```" />
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.issue.details">
      <path value="OperationOutcome.issue.details" />
      <definition value="Additional details about the error. This may be a text description of the error or a system code that identifies the error.&#xD;&#xA;&#xD;&#xA;```json&#xD;&#xA;&quot;details&quot;: {&#xD;&#xA;                &quot;coding&quot;: [&#xD;&#xA;                    {&#xD;&#xA;                        &quot;system&quot;: &quot;https://fhir.nhs.uk/CodeSystem/Spine-ErrorOrWarningCode&quot;,&#xD;&#xA;                        &quot;code&quot;: &quot;INVALID_VALUE&quot;,&#xD;&#xA;                        &quot;display&quot;: &quot;Invalid value&quot;&#xD;&#xA;                    }&#xD;&#xA;                ]&#xD;&#xA;            }&#xD;&#xA;```" />
      <mustSupport value="true" />
      <binding>
        <strength value="preferred" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-OperationOutcomeCodes" />
      </binding>
    </element>
    <element id="OperationOutcome.issue.details.coding">
      <path value="OperationOutcome.issue.details.coding" />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
      <binding>
        <strength value="extensible" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-OperationOutcomeCodes" />
      </binding>
    </element>
    <element id="OperationOutcome.issue.details.coding.system">
      <path value="OperationOutcome.issue.details.coding.system" />
      <min value="1" />
    </element>
    <element id="OperationOutcome.issue.details.coding.code">
      <path value="OperationOutcome.issue.details.coding.code" />
      <min value="1" />
    </element>
    <element id="OperationOutcome.issue.diagnostics">
      <path value="OperationOutcome.issue.diagnostics" />
      <definition value="Additional diagnostic information about the issue. User readable version of the message. Include url's for further information or other information helpful for the user to understand the error." />
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.issue.location">
      <path value="OperationOutcome.issue.location" />
      <definition value="Use the JSON Pointer standard to describe the source of the error - e.g. parameter, or payload value.&#xD;&#xA;&#xD;&#xA;```json&#xD;&#xA;&quot;location&quot;: [&#xD;&#xA;                &quot;Patient&quot;,&#xD;&#xA;                &quot;Line 1, Col 37&quot;&#xD;&#xA;            ]```" />
      <mustSupport value="true" />
    </element>
    <element id="OperationOutcome.issue.expression">
      <path value="OperationOutcome.issue.expression" />
      <definition value="FHIRPath of element(s) related to issue" />
      <mustSupport value="true" />
    </element>
  </differential>
</StructureDefinition>