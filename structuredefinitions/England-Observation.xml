<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
	<id value="England-Observation"/>
	<url value="https://fhir.nhs.uk/StructureDefinition/England-Observation"/>
	<version value="1.0.0"/>
	<name value="EnglandObservation"/>
	<title value="England Observation"/>
	<status value="draft"/>
	<date value="2023-08-15"/>
	<publisher value="NHS England"/>
	<contact>
		<name value="NHS England"/>
		<telecom>
			<system value="email"/>
			<value value="interoperabilityteam@nhs.net"/>
			<use value="work"/>
			<rank value="1"/>
		</telecom>
	</contact>
	<description value="This profile defines the NHS England constraints and extensions on the FHIR UK Core resource [UK Core Observation](https://simplifier.net/hl7fhirukcorer4/ukcore-Observation)."/>
	<purpose value="This profile allows exchange of information of Measurements and simple assertions made about an individual, device or other subject."/>
	<copyright value="Copyright © 2021+ HL7 UK Licensed under the Apache License, Version 2.0 (the \&quot;License\&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at  http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. HL7® FHIR® standard Copyright © 2011+ HL7 The HL7® FHIR® standard is used under the FHIR license. You may obtain a copy of the FHIR license at  https://www.hl7.org/fhir/license.html."/>
	<fhirVersion value="4.0.1"/>
	<kind value="resource"/>
	<abstract value="false"/>
	<type value="Observation"/>
	<baseDefinition value="https://fhir.hl7.org.uk/StructureDefinition/UKCore-Observation"/>
	<derivation value="constraint"/>
	<differential>
		<element id="Observation.extension">
			<path value="Observation.extension"/>
			<slicing>
				<discriminator>
					<type value="value"/>
					<path value="url"/>
				</discriminator>
				<rules value="open"/>
			</slicing>
			<min value="0"/>
		</element>
		<element id="Observation.extension:covid19Testing">
			<path value="Observation.extension"/>
			<sliceName value="covid19Testing"/>
			<min value="0"/>
			<max value="1"/>
			<type>
				<code value="Extension"/>
				<profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-COVID19TestResult"/>
			</type>
			<isModifier value="false"/>
		</element>
		<element id="Observation.identifier">
			<path value="Observation.identifier"/>
			<min value="1"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.identifier.system">
			<path value="Observation.identifier.system"/>
			<min value="1"/>
		</element>
		<element id="Observation.identifier.value">
			<path value="Observation.identifier.value"/>
			<min value="1"/>
		</element>
		<element id="Observation.status">
			<path value="Observation.status"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.category">
			<path value="Observation.category"/>
			<slicing>
				<discriminator>
					<type value="value"/>
					<path value="coding.system"/>
				</discriminator>
				<rules value="open"/>
			</slicing>
			<mustSupport value="true"/>
			<binding>
				<strength value="required"/>
				<valueSet value="https://fhir.nhs.uk/ValueSet/England-ObservationCategory"/>
			</binding>
		</element>
		<element id="Observation.category.coding">
			<path value="Observation.category.coding"/>
			<min value="1"/>
		</element>
		<element id="Observation.category.coding.system">
			<path value="Observation.category.coding.system"/>
			<min value="1"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.category.coding.code">
			<path value="Observation.category.coding.code"/>
			<min value="1"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.category:COVID-TestPillar">
			<path value="Observation.category"/>
			<sliceName value="COVID-TestPillar"/>
			<max value="1"/>
		</element>
		<element id="Observation.category:COVID-TestPillar.coding.system">
			<path value="Observation.category.coding.system"/>
			<fixedUri value="https://fhir.nhs.uk/CodeSystem/England-CovidTestPillar"/>
		</element>
		<element id="Observation.category:UKCoreCategory">
			<path value="Observation.category"/>
			<sliceName value="UKCoreCategory"/>
		</element>
		<element id="Observation.category:UKCoreCategory.coding.system">
			<path value="Observation.category.coding.system"/>
			<fixedUri value="http://terminology.hl7.org/CodeSystem/v3-ObservationCategory"/>
		</element>
		<element id="Observation.code">
			<path value="Observation.code"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.subject">
			<path value="Observation.subject"/>
			<min value="1"/>
			<constraint>
				<key value="nhse-obs-001"/>
				<severity value="warning"/>
				<human value="subject - An identifier reference or resource reference must be provided"/>
				<expression value="(reference.exists() or (identifier.exists()))"/>
			</constraint>
			<constraint>
				<key value="nhse-obs-002"/>
				<severity value="error"/>
				<human value="Length of the supplied NHS Number is wrong."/>
				<expression value="identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists().not() or (identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists()  and identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').value.matches('^([0-9]{10})$'))"/>
			</constraint>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.subject.identifier.system">
			<path value="Observation.subject.identifier.system"/>
			<min value="1"/>
			<fixedUri value="https://fhir.nhs.uk/Id/nhs-number"/>
		</element>
		<element id="Observation.subject.identifier.value">
			<path value="Observation.subject.identifier.value"/>
			<min value="1"/>
		</element>
		<element id="Observation.effective[x]">
			<path value="Observation.effective[x]"/>
			<min value="1"/>
			<type>
				<code value="dateTime"/>
			</type>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.performer">
			<path value="Observation.performer"/>
			<type>
				<code value="Reference"/>
				<aggregation value="referenced"/>
			</type>
			<constraint>
				<key value="nhse-obs-003"/>
				<severity value="error"/>
				<human value="An identifier reference or resource reference must be provided"/>
				<expression value="(reference.exists() or identifier.exists())"/>
			</constraint>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.value[x]">
			<path value="Observation.value[x]"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.method">
			<path value="Observation.method"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.method.coding.system">
			<path value="Observation.method.coding.system"/>
			<min value="1"/>
		</element>
		<element id="Observation.method.coding.code">
			<path value="Observation.method.coding.code"/>
			<min value="1"/>
		</element>
		<element id="Observation.method.coding.display">
			<path value="Observation.method.coding.display"/>
			<min value="1"/>
		</element>
		<element id="Observation.specimen">
			<path value="Observation.specimen"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.specimen.identifier.system">
			<path value="Observation.specimen.identifier.system"/>
			<min value="1"/>
		</element>
		<element id="Observation.specimen.identifier.value">
			<path value="Observation.specimen.identifier.value"/>
			<min value="1"/>
		</element>
		<element id="Observation.device">
			<path value="Observation.device"/>
			<mustSupport value="true"/>
		</element>
		<element id="Observation.device.identifier.system">
			<path value="Observation.device.identifier.system"/>
			<min value="1"/>
		</element>
		<element id="Observation.device.identifier.value">
			<path value="Observation.device.identifier.value"/>
			<min value="1"/>
		</element>
		<element id="Observation.device.display">
			<path value="Observation.device.display"/>
			<min value="1"/>
		</element>
	</differential>
</StructureDefinition>